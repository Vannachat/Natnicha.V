<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tarot Table 🔮</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    #loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff8e1;
      font-family: "Segoe UI", sans-serif;
      font-size: 20px;
    }
  </style>

  <!-- Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>
  <div id="loading">🔮 Loading...</div>

  <script>
    const scene = new THREE.Scene();

    // 🌌 โหลดภาพพื้นหลัง (วางไฟล์ bg.jpg หรือ bg.png ในโฟลเดอร์เดียวกับไฟล์นี้)
    const textureLoader = new THREE.TextureLoader();
    textureLoader.load("./bg.png", (texture) => {
      scene.background = texture;
    }, undefined, (error) => {
      console.warn("⚠️ โหลดภาพพื้นหลังไม่สำเร็จ:", error);
    });

    // 📷 Camera
    const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 5000);
    camera.position.set(0, 190, 650);
    camera.lookAt(0, 100, 0);

    // 🎥 Renderer
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    document.body.appendChild(renderer.domElement);

    // 🎮 Controls
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.target.set(0, 100, 0);
    controls.enableDamping = true;
    controls.enableZoom = true;
    controls.minDistance = 300;
    controls.maxDistance = 1000;

    // 💡 แสงหลัก
    const ambient = new THREE.AmbientLight(0xffffff, 0.5);
    const keyLight = new THREE.SpotLight(0xfff6d9, 1.5);
    keyLight.position.set(250, 400, 200);
    keyLight.castShadow = true;
    keyLight.angle = Math.PI / 4;
    keyLight.penumbra = 0.4;
    const fillLight = new THREE.PointLight(0x77aaff, 0.6);
    fillLight.position.set(-300, 200, 100);
    const rimLight = new THREE.PointLight(0xffaa88, 0.8);
    rimLight.position.set(0, 300, -300);
    scene.add(ambient, keyLight, fillLight, rimLight);

    const loader = new THREE.GLTFLoader();
    let profileText = null;
    let randomButton = null;

    // 🔮 โหลดโมเดลโต๊ะ
    loader.load("./random1.glb", function (gltf) {
      const model = gltf.scene;
      model.scale.set(100, 100, 100);
      scene.add(model);
    });

    // 🪄 โหลดโมเดลข้อความ "โปรไฟล์"
    loader.load("./T_5.glb", function (gltf) {
      profileText = gltf.scene;
      profileText.scale.set(80, 80, 80);
      profileText.position.set(20, 6, 0);
      scene.add(profileText);
    });

    // ✨ โหลดโมเดลข้อความ "เริ่มสุ่ม"
    loader.load("./TR_3.glb", function (gltf) {
      randomButton = gltf.scene;
      randomButton.scale.set(80, 80, 80);
      randomButton.position.set(-250, -80, 0); // ใต้คำว่าโปรไฟล์
      scene.add(randomButton);

      // เพิ่มแสงส่องปุ่มสุ่ม
      const randomLight = new THREE.PointLight(0x88ccff, 1.2, 250);
      randomLight.position.set(250, 50, 100);
      scene.add(randomLight);

      document.getElementById("loading").style.display = "none";
    });

    // 🖱️ ตรวจจับคลิก
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    window.addEventListener("click", (event) => {
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
      raycaster.setFromCamera(mouse, camera);

      if (profileText) {
        const hitProfile = raycaster.intersectObject(profileText, true);
        if (hitProfile.length > 0) {
          console.log("✅ Click โปรไฟล์ -> name.html");
          window.location.href = "./name.html";
        }
      }

      if (randomButton) {
        const hitRandom = raycaster.intersectObject(randomButton, true);
        if (hitRandom.length > 0) {
          console.log("🎴 Click เริ่มสุ่ม -> random.html");
          window.location.href = "./random.html";
        }
      }
    });

    // 🔁 Loop
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
