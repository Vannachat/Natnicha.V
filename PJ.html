<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Three.js Rocket Zoom Scene</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
        }

        canvas {
            display: block;
        }
    </style>

    <!-- âœ… à¹‚à¸«à¸¥à¸” Tween.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@18.6.4/dist/tween.umd.js"></script>

    <!-- âœ… à¹‚à¸«à¸¥à¸” Three.js à¹à¸¥à¸°à¸ªà¹ˆà¸§à¸™à¹€à¸ªà¸£à¸´à¸¡ -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dat.gui/build/dat.gui.min.js"></script>
</head>

<body>
    <script>
        // ======================
        // ðŸ”§ Basic Setup
        // ======================
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.outputEncoding = THREE.sRGBEncoding;
        document.body.appendChild(renderer.domElement);

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000010);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 5, 15);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        // ======================
        // ðŸ’¡ Lights
        // ======================
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.8);
        dirLight.position.set(5, 10, 5);
        dirLight.castShadow = true;
        scene.add(dirLight);

        const ambient = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambient);

        // ======================
        // ðŸŒ Ground
        // ======================
        const planeGeometry = new THREE.PlaneGeometry(40, 40);
        const planeMaterial = new THREE.ShadowMaterial({ opacity: 0.3 });
        const plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.rotation.x = -Math.PI / 2;
        plane.position.y = 0;
        plane.receiveShadow = true;
        scene.add(plane);

        // ======================
        // ðŸš€ Loaders
        // ======================
        const loader = new THREE.GLTFLoader();
        let rocketModel = null;

        // ----- Step 1: à¹‚à¸«à¸¥à¸”à¸ˆà¸£à¸§à¸” -----
        loader.load(
            './text1.glb',
            function (rocketGltf) {
                rocketModel = rocketGltf.scene;
                rocketModel.traverse(function (child) {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = true;
                    }
                });

                rocketModel.scale.set(1, 1, 1);
                rocketModel.position.set(0, 3.5, 0);
                rocketModel.rotation.y = Math.PI;
                scene.add(rocketModel);

                console.log('ðŸš€ Rocket model loaded!');

                // à¸•à¸±à¹‰à¸‡à¸à¸¥à¹‰à¸­à¸‡à¹ƒà¸«à¹‰à¸¡à¸­à¸‡à¸ˆà¸£à¸§à¸”à¸à¹ˆà¸­à¸™
                const box = new THREE.Box3().setFromObject(rocketModel);
                const center = box.getCenter(new THREE.Vector3());
                controls.target.copy(center);
                camera.lookAt(center);

                // à¹‚à¸«à¸¥à¸”à¹‚à¸¡à¹€à¸”à¸¥à¹‚à¸¥à¸à¸ à¸²à¸¢à¸«à¸¥à¸±à¸‡ (à¸«à¸™à¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸² 3 à¸§à¸´)
                setTimeout(() => loadMainModel(), 3000);
            },
            (xhr) => console.log(`Rocket loading: ${(xhr.loaded / xhr.total * 100).toFixed(2)}%`),
            (error) => console.error('âŒ Rocket load error:', error)
        );

        // ----- Step 2: à¹‚à¸«à¸¥à¸”à¹‚à¸¡à¹€à¸”à¸¥à¹‚à¸¥à¸ -----
        function loadMainModel() {
            loader.load(
                './pj.glb',
                function (gltf) {
                    gltf.scene.traverse(function (child) {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                        }
                    });

                    gltf.scene.scale.set(1, 1, 1);
                    gltf.scene.position.set(0, 0, 0);
                    gltf.scene.rotation.y = Math.PI;
                    scene.add(gltf.scene);

                    console.log('âœ… Main model loaded!');

                    // à¸‹à¸¹à¸¡à¸à¸¥à¹‰à¸­à¸‡à¹€à¸‚à¹‰à¸²à¸«à¸²à¹‚à¸¡à¹€à¸”à¸¥à¸«à¸¥à¸±à¸
                    new TWEEN.Tween(camera.position)
                        .to({ x: 0, y: 3, z: 7 }, 2500)
                        .easing(TWEEN.Easing.Quadratic.InOut)
                        .start();

                    const box = new THREE.Box3().setFromObject(gltf.scene);
                    const center = box.getCenter(new THREE.Vector3());
                    new TWEEN.Tween(controls.target)
                        .to(center, 2500)
                        .easing(TWEEN.Easing.Quadratic.InOut)
                        .start();
                },
                (xhr) => console.log(`Main model loading: ${(xhr.loaded / xhr.total * 100).toFixed(2)}%`),
                (error) => console.error('âŒ Main GLB load error:', error)
            );
        }

        // ======================
        // ðŸ–±ï¸ Click Rocket â†’ Move beside world
        // ======================
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        window.addEventListener('click', (event) => {
            if (!rocketModel) return;

            // à¹à¸›à¸¥à¸‡à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸„à¸¥à¸´à¸
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObject(rocketModel, true);

            // à¸–à¹‰à¸²à¸„à¸¥à¸´à¸à¹‚à¸”à¸™à¸ˆà¸£à¸§à¸”
            if (intersects.length > 0) {
                console.log("ðŸ›°ï¸ Rocket clicked! Moving aside...");

                // ðŸš€ à¸¢à¹‰à¸²à¸¢à¹„à¸›à¸‚à¹‰à¸²à¸‡à¹‚à¸¥à¸à¹ƒà¸«à¹‰à¹„à¸à¸¥à¸‚à¸¶à¹‰à¸™ (à¸ˆà¸²à¸ 5 â†’ 10)
                new TWEEN.Tween(rocketModel.position)
                    .to({ x: 10, y: 2.5, z: 0 }, 2500) // âœ… à¸‚à¸¢à¸±à¸šà¸«à¹ˆà¸²à¸‡à¸­à¸­à¸à¹„à¸›à¸à¸§à¹ˆà¸²à¹€à¸”à¸´à¸¡
                    .easing(TWEEN.Easing.Quadratic.InOut)
                    .start();

                // ðŸ” à¸«à¸”à¸‚à¸™à¸²à¸”à¸¥à¸‡à¸­à¸µà¸à¹€à¸¥à¹‡à¸à¸™à¹‰à¸­à¸¢ (à¸ˆà¸²à¸ 0.5 â†’ 0.4)
                new TWEEN.Tween(rocketModel.scale)
                    .to({ x: 0.4, y: 0.4, z: 0.4 }, 2500)
                    .easing(TWEEN.Easing.Quadratic.InOut)
                    .start();
            }
        });

        // ======================
        // ðŸ”„ Animation Loop
        // ======================
        function animate() {
            requestAnimationFrame(animate);
            TWEEN.update();
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // ðŸ“ Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>

</html>
