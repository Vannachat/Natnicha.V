<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rocket to World Transition</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
    #backButton {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.8);
      border: none;
      border-radius: 5px;
      cursor: pointer;
      display: none;
      font-size: 16px;
    }
  </style>

  <!-- âœ… Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@18.6.4/dist/tween.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dat.gui/build/dat.gui.min.js"></script>
</head>
<body>
  <button id="backButton">ðŸ”™ Back to Rocket</button>

<script>
  // ======================
  // ðŸ”§ Basic Setup
  // ======================
  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;
  renderer.outputEncoding = THREE.sRGBEncoding;
  document.body.appendChild(renderer.domElement);

  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x000010);

  const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.set(0, 5, 15);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  const loader = new THREE.GLTFLoader();
  let rocketModel, worldModel;

  // à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸‚à¸­à¸‡à¸ˆà¸£à¸§à¸”
  const rocketStartPosition = new THREE.Vector3(0, 3.5, 0);
  const rocketStartScale = new THREE.Vector3(1, 1, 1);

  // ======================
  // ðŸ’¡ Lights
  // ======================
  const dirLight = new THREE.DirectionalLight(0xffffff, 1.8);
  dirLight.position.set(5, 10, 5);
  dirLight.castShadow = true;
  scene.add(dirLight);

  const ambient = new THREE.AmbientLight(0xffffff, 0.6);
  scene.add(ambient);

  // ======================
  // ðŸš€ Load Rocket Model
  // ======================
  loader.load(
    './text1.glb',
    (gltf) => {
      rocketModel = gltf.scene;
      rocketModel.traverse(child => {
        if (child.isMesh) {
          child.castShadow = true;
          child.receiveShadow = true;
        }
      });
      rocketModel.position.copy(rocketStartPosition);
      rocketModel.scale.copy(rocketStartScale);
      rocketModel.rotation.y = Math.PI;
      scene.add(rocketModel);
      console.log('ðŸš€ Rocket model loaded!');
    },
    (xhr) => console.log(`Rocket loading: ${(xhr.loaded / xhr.total * 100).toFixed(2)}%`),
    (err) => console.error('Rocket load error:', err)
  );

  // ======================
  // ðŸŒ Load World Model
  // ======================
  function loadWorldScene() {
    loader.load(
      './pj.glb',
      (gltf) => {
        worldModel = gltf.scene;
        worldModel.traverse(child => {
          if (child.isMesh) {
            child.castShadow = true;
            child.receiveShadow = true;
          }
        });
        worldModel.scale.set(1, 1, 1);
        worldModel.position.set(0, 0, 0);
        worldModel.rotation.y = Math.PI;
        scene.add(worldModel);
        console.log('ðŸŒ World model loaded!');

        // à¸¢à¹‰à¸²à¸¢à¸ˆà¸£à¸§à¸”à¹„à¸›à¸­à¸¢à¸¹à¹ˆà¸‚à¹‰à¸²à¸‡à¹‚à¸¥à¸
        new TWEEN.Tween(rocketModel.position)
          .to({ x: 10, y: 2.5, z: 0 }, 2000)
          .easing(TWEEN.Easing.Quadratic.InOut)
          .start();

        new TWEEN.Tween(rocketModel.scale)
          .to({ x: 0.5, y: 0.5, z: 0.5 }, 2000)
          .easing(TWEEN.Easing.Quadratic.InOut)
          .start();

        // à¸‹à¸¹à¸¡à¸à¸¥à¹‰à¸­à¸‡à¹€à¸‚à¹‰à¸²à¹‚à¸¥à¸
        new TWEEN.Tween(camera.position)
          .to({ x: 0, y: 3, z: 8 }, 2500)
          .easing(TWEEN.Easing.Quadratic.InOut)
          .start();

        // à¸›à¸£à¸±à¸šà¸à¸¥à¹‰à¸­à¸‡à¹ƒà¸«à¹‰à¹‚à¸Ÿà¸à¸±à¸ªà¹‚à¸¥à¸
        const box = new THREE.Box3().setFromObject(worldModel);
        const center = box.getCenter(new THREE.Vector3());
        new TWEEN.Tween(controls.target)
          .to(center, 2500)
          .easing(TWEEN.Easing.Quadratic.InOut)
          .start();

        document.getElementById("backButton").style.display = "block";
      },
      (xhr) => console.log(`World loading: ${(xhr.loaded / xhr.total * 100).toFixed(2)}%`),
      (err) => console.error('World load error:', err)
    );
  }

  // ======================
  // ðŸ”™ Go Back to Rocket
  // ======================
  function goBackToRocket() {
    if (worldModel) scene.remove(worldModel); // à¸¥à¸šà¹‚à¸¥à¸à¸­à¸­à¸

    // à¸£à¸µà¹€à¸‹à¹‡à¸•à¸ˆà¸£à¸§à¸”à¸à¸¥à¸±à¸šà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹€à¸”à¸´à¸¡
    new TWEEN.Tween(rocketModel.position)
      .to({ x: rocketStartPosition.x, y: rocketStartPosition.y, z: rocketStartPosition.z }, 2000)
      .easing(TWEEN.Easing.Quadratic.InOut)
      .start();

    new TWEEN.Tween(rocketModel.scale)
      .to({ x: rocketStartScale.x, y: rocketStartScale.y, z: rocketStartScale.z }, 2000)
      .easing(TWEEN.Easing.Quadratic.InOut)
      .start();

    // à¸à¸¥à¹‰à¸­à¸‡à¸à¸¥à¸±à¸šà¹„à¸›à¸¡à¸¸à¸¡à¹€à¸”à¸´à¸¡
    new TWEEN.Tween(camera.position)
      .to({ x: 0, y: 5, z: 15 }, 2500)
      .easing(TWEEN.Easing.Quadratic.InOut)
      .start();

    new TWEEN.Tween(controls.target)
      .to({ x: 0, y: 3, z: 0 }, 2500)
      .easing(TWEEN.Easing.Quadratic.InOut)
      .start();

    document.getElementById("backButton").style.display = "none";
  }

  document.getElementById("backButton").addEventListener("click", goBackToRocket);

  // ======================
  // ðŸ–± Click Detection
  // ======================
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();
  window.addEventListener('click', (event) => {
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
    raycaster.setFromCamera(mouse, camera);
    const intersects = raycaster.intersectObjects(scene.children, true);
    if (intersects.length > 0 && intersects[0].object) {
      const obj = intersects[0].object;
      if (rocketModel && rocketModel.getObjectById(obj.id)) {
        loadWorldScene();
      }
    }
  });

  // ======================
  // ðŸŽ› dat.GUI
  // ======================
  const gui = new dat.GUI();
  const dirFolder = gui.addFolder('Directional Light');
  dirFolder.add(dirLight.position, 'x', -20, 20).step(0.1);
  dirFolder.add(dirLight.position, 'y', -20, 20).step(0.1);
  dirFolder.add(dirLight.position, 'z', -20, 20).step(0.1);
  dirFolder.add(dirLight, 'intensity', 0, 5).step(0.1);
  dirFolder.open();

  const ambFolder = gui.addFolder('Ambient Light');
  ambFolder.add(ambient, 'intensity', 0, 3).step(0.1);
  ambFolder.open();

  // ======================
  // ðŸ”„ Animate
  // ======================
  function animate() {
    requestAnimationFrame(animate);
    TWEEN.update();
    controls.update();
    renderer.render(scene, camera);
  }
  animate();

  // ======================
  // ðŸ“ Resize
  // ======================
  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>
</body>
</html>
